import { HorizontalBox, Button, VerticalBox, Slider, ScrollView } from "std-widgets.slint";

export global Settings {
    
    // This property is only used internally to force refreshing the view.
    in property <bool> refresh;

    in property <float> handle_length: 50.0;
    in property <float> repulsion_strength: 5.0;
    in property <float> timestep: 25.0;
    in property <float> state_radius: 5.0;
    
    in property <float> zoom_level: 1.0;
    in property <length> view_x: 1000px;
    in property <length> view_y: 1000px;
}

export component Application inherits Window {
    title: @tr("LTSGraph");
    icon: @image-url("../data/mcrl2-blue.png");

    preferred-width: 1280px;
    preferred-height: 720px;

    // Render the simulation to an image.
    pure callback update_canvas(length, length, bool) -> image;
    pure callback canvas_clicked();
    pure callback settings_changed();
    pure callback open_filedialog();

    HorizontalBox {
        width: parent.width;
        alignment: end;

        Image {

            source: update_canvas(parent.width, parent.height, Settings.refresh);
            Text {
                text: @tr("{} {}", Settings.view_x / 1px, Settings.view_y / 1px);
            }

            TouchArea {

                pointer-event(e) => {
                }

                moved => {
                    Settings.view_x = self.mouse-x;
                    Settings.view_y = self.mouse-y;
                    settings_changed();
                }
            }
        }

        Rectangle {
            width: 2px;
            background: gray;
        }

        // The controls on the right menu
        VerticalBox { 
            width: 20%;
            alignment: start;
            padding-right: 10px;
            
            Button {
                text: @tr("Load LTS");
                clicked => { open_filedialog(); }
            }

            Rectangle {
                height: 1%;
            }

            Text {
                text: @tr("Layout controls");
                font-size: 20px;
            }
            
            Text {
                text: {
                    "Handle Length: " + Settings.handle_length
                };
            }

            Slider {
                value: 50.0;
                minimum: 5.0;
                maximum: 250.0;
                changed => { 
                    Settings.handle_length = self.value;
                    settings_changed();
                }
            }

            Text {
                text: @tr("Repulsion strength: {}", Settings.repulsion_strength);
            }
            
            Slider {
                value: 1.0;
                minimum: 0.1;
                maximum: 5.0;
                changed => { 
                    Settings.repulsion_strength = self.value; 
                    settings_changed();
                }
            }
            
            Text {
                text: "Timestep: " + Settings.timestep;
            }

            Slider {
                value: 25.0;
                minimum: 0.0;
                maximum: 100.0;
                changed => { 
                    Settings.timestep = self.value; 
                    settings_changed();
                }
            }

            Rectangle {
                height: 1%;
            }

            Text {
                text: @tr("View controls");
                font-size: 20px;
            }
            
            Text {
                text: "State radius:" + Settings.state_radius;
            }

            Slider {
                value: 5.0;
                minimum: 5.0;
                maximum: 25.0;
                changed => { 
                    Settings.state_radius = self.value; 
                    settings_changed();
                }
            }
        }
    }

}